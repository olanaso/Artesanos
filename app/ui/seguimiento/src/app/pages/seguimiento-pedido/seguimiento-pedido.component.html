<div class="container mx-auto p-4 max-w-4xl">
  <div class="flex justify-center mb-12">
    <img
      src="https://artesaniasdeayacucho.pe/img/logoPrincipal.svg"
      alt="Company Logo"
      width="200"
      height="60"
      class="h-auto w-48"
    />
  </div>

  <h1 class="text-3xl font-bold mb-4 mt-2 text-pink-600">
    Seguimiento de pedidos
  </h1>

  <!-- agrega una linea -->
  <div class="border-b-2 border-gray-500 mb-4"></div>

  <div class="flex flex-col sm:flex-row gap-2 mb-4">
    <input
      placeholder="Ingrese el número de pedido"
      class="flex-grow p-2 border rounded focus:outline-none focus:ring-pink-600 focus:border-pink-600"
      [formControl]="codigoPedidoInput"
      (keyup.enter)="buscarPedido()"
    />

    <button
      class="bg-pink-600 text-white p-2 rounded flex items-center justify-center"
      (click)="buscarPedido()"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="16"
        height="16"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
        class="mr-2 h-4 w-4"
      >
        <circle cx="11" cy="11" r="8" />
        <path d="m21 21-4.3-4.3" />
      </svg>
      Buscar
    </button>
  </div>

  @if (pedido() && !estaBuscandoPedido()) {
    <div class="bg-white shadow-lg rounded-lg border border-gray-200">
      <div class="p-4">
        <div class="grid md:grid-cols-2 gap-4">
          <div>
            <h2 class="font-bold text-lg mb-1">
              N° de pedido: {{ pedido()?.num_pedido }}
            </h2>

            <p class="text-gray-600">
              <span class="text-gray-700 font-medium"
                >Fecha y hora del Pedido:</span
              >
              {{ pedido()?.fecha_pedido | date : "dd/MM/yyyy HH:mm" }}
            </p>

            <p class="text-gray-600">
              <span class="text-gray-700 font-medium"> Total pagado:</span> S/
              {{ totalPagado() | number : "1.2-2" }}
            </p>

            <div class="my-2">
              <button
                class="text-blue-600 underline text-sm"
                (click)="abrirComprobanteModal(pedido()!)"
              >
                Ver detalles de la compra
              </button>
            </div>


            <a
              class="w-full mt-2 p-2 border rounded bg-green-300 hover:bg-green-400 text-green-700 flex items-center justify-center cursor-pointer"
              href="https://wa.me/+51{{ pedido()?.artesano?.celular }}?text=tengo%20una%20consulta%20sobre%20mi%20pedido"
              target="_blank"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                class="mr-2 h-4 w-4"
              >
                <path
                  d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"
                />
              </svg>
              Contactar
            </a>
          </div>

          <div>
            <h2 class="font-bold text-lg mb-1">Sigue tu pedido:</h2>
            <div class="space-y-2">
              @for (atencion of listaAtencion(); track atencion.id) {
              <div class="flex items-stretch border rounded-lg overflow-hidden">
                <div
                  class="flex items-center justify-center bg-gray-100 w-12 font-bold text-gray-700"
                >
                  {{ $index + 1 }}
                </div>

                <div class="flex-grow p-1 flex justify-between items-center">
                  <div>
                    <p class="font-medium text-gray-700">
                      {{ atencion.enlaceSeguimiento }}
                    </p>
                    <p class="text-sm text-gray-500">
                      {{ atencion.fecha_atencion | date : "dd/MM/yyyy HH:mm" }}
                    </p>
                  </div>

                  <span
                    [ngClass]="{
                      'px-2 py-1 rounded-full text-xs font-semibold': true,
                      'bg-green-100 text-green-800': atencion.estado === 'pagado',
                      'bg-pink-100 text-pink-800': atencion.estado === 'enviado',
                      'bg-blue-100 text-blue-800':
                        atencion.estado === 'finalizado'
                    }"
                  >
                    {{ atencion.estado }}
                  </span>
                </div>
              </div>
              }
            </div>
          </div>
        </div>
      </div>
    </div>
  }

  @if (pedidoNoEncontrado()) {
    <div
      class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative"
      role="alert"
    >
      <strong class="font-bold">¡Pedido no encontrado!</strong>
      <span class="block sm:inline">
        El código de pedido ingresado no existe.</span
      >
    </div>
  }

  @if (estaBuscandoPedido()) {
    <div class="flex items-center justify-center mt-4">
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="24"
        height="24"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
        class="animate-spin h-8 w-8 text-gray-600"
      >
        <circle cx="12" cy="12" r="10" />
        <line x1="12" y1="6" x2="12" y2="12" />
        <line x1="12" y1="12" x2="12" y2="18" />
      </svg>
    </div>
  }
</div>
